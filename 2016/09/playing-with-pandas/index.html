
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Playing With Pandas - littlebigtomatoes</title>
  <meta name="author" content="Krisztian Gyuris">

  
  <meta name="description" content="This is the third part of the articles I am writing about my little project I am working on. In part1, I created a web scraper to get the data I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.littlebigtomatoes.com/2016/09/playing-with-pandas">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/Littlebigtomatoes" rel="alternate" title="littlebigtomatoes" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!-- scripts -->
<script src="//load.sumome.com/" data-sumo-site-id="a4b0beb7e87f85911a55eaba54b37e42e4bdad574ffd057b5dedf1e94d49348d" async="async"></script>
<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55456-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">littlebigtomatoes</a></h1>
  
    <h2>Design.Create.Smile.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/Littlebigtomatoes" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.littlebigtomatoes.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/projects">Projects</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Playing With Pandas</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-26T11:58:11+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:58 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://www.littlebigtomatoes.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>This is the third part of the articles I am writing about my little project I am working on. In part1, I created a web scraper to get the data I needed. In part 2, I added support to save the collected data to a mongodb database. Now in this part, I will look into how to clean up and add new features (columns) to the collected data to make it more suitable for analysis.</p>

<p>My primary motivation here is to learn new technologies as I progress, so my baby steps may not be the state of art in this particular area and all tips and tricks or corrections are welcome.</p>

<p>For this project I am using python and each day I love it more and more. There are some cool libraries for python such as pandas that will be used. There are some col tools such as python notebooks that will be also used.</p>

<!--more-->


<p></p>

<p>For starts, make sure that you have jupiter notebook installed on your machine and then start <a href="http://jupyter.org/">Jupyter Notebooks</a> from the git repo folder.</p>

<figure class='code'><figcaption><span>installing and starting jupiter notebook </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install jupiter
</span><span class='line'><span class="nb">cd</span> /path/to/stackjobs
</span><span class='line'>jupiter notebooks
</span></code></pre></td></tr></table></div></figure>


<p>With this command, we started the iPython (Jupyter) notebooks and a new browser will be opened. Click on the <a href="https://github.com/gyurisc/stackjobs/blob/master/notebooks/Enhancing%20and%20Extending%20data%20with%20Pandas%20.ipynb">Enhancing and Extending data with Pandas</a> notebook to see and run the code that this article with describe. Also the <a href="https://github.com/gyurisc/stackjobs/blob/master/enhance_data_with_pandas.py">enhance_data_with_pandas.py</a> file contains the same code, so it can be run without iptyhon notebook.</p>

<h2>Exploring data with pandas</h2>

<p>First of all we need to import some libraries and make some changes to how the data is printed out.</p>

<p>The changes in the display options e.g display.max_columns and display.max_rows are need in order for me to see the whole data when printed in the notebook and not just a few lines. Feel free to comment it out…</p>

<figure class='code'><figcaption><span>importing libraries and setting options and then reading the data</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Let&#39;s change how printing the series works. I need to see all elements in the Series </span>
</span><span class='line'><span class="c"># source: http://stackoverflow.com/questions/19124601/is-there-a-way-to-pretty-print-the-entire-pandas-series-dataframe</span>
</span><span class='line'><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</span><span class='line'><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">jobs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&#39;data/stackoverflow_jobs.csv&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, there are three calls to see what kind of data we loaded into our <em>jobs</em> data frame. We print out the columns, the types of the columns and some generic numerical data describing the dataset loaded. In the last one, the most important is the count that is telling us how many rows of data we loaded.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">columns</span> <span class="c"># just show the columns </span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">dtypes</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span> <span class="c"># show me the row count</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can also print out the first and last few lines of the data, to have a look what we have using the <em>tail()</em> and <em>head()</em> method calls.</p>

<figure class='code'><figcaption><span>display the head and tail of the data</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Working with Salary</h2>

<p>In our jobs data, we have the <em>salary</em> column that may or may not contains the salary is offered by the company for a particular position. When we have missing values in that column that can cause issues for further processing, so let’s replace the NA values with empty strings.</p>

<figure class='code'><figcaption><span>Replacing NA values with empty strings in the salary column</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">salary</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">salary</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Next, we will extract the information, if the given position offers equity or not and store it in a new column called <em>equity</em>.</p>

<figure class='code'><figcaption><span>Extracting equity</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;equity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs</span><span class="p">[</span><span class="s">&#39;salary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Provides Equity&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Next, we will move the salary data to a new series object and remove the <em>Provides Equity</em> in order to make it easier to extract the other values. The reason for this is that I would like to leave the other columns as they were originally and do the needed modifications in the new columns or in some temp variables.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">salary</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">salary</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;Provides Equity&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we removed the <em>Provides Equity</em> from the salary information our data is either an empty string or contains the currency information and the low high figure of the salary information. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">€</span><span class="mi">50</span><span class="p">,</span><span class="mo">000</span> <span class="o">-</span> <span class="mi">71</span><span class="p">,</span><span class="mo">000</span>
</span><span class='line'><span class="err">£</span><span class="mi">35</span><span class="p">,</span><span class="mo">000</span> <span class="o">-</span> <span class="mi">65</span><span class="p">,</span><span class="mo">000</span>
</span><span class='line'><span class="err">$</span><span class="mi">65</span><span class="p">,</span><span class="mo">000</span> <span class="o">-</span> <span class="mi">125</span><span class="p">,</span><span class="mo">000</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>This information will be extracted using regular expression and captured in different columns. For the rows with empty values, it is recommended to provide a default value. Empty string for the currency and zero for the low-high figure.</p>

<p>Then we map back the new information to the jobs data frame.</p>

<figure class='code'><figcaption><span>extracting and capturing currency and low-high figure. </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># salary = jobs.salary</span>
</span><span class='line'><span class="n">salary</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">salary</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;Provides Equity&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="n">sal</span> <span class="o">=</span> <span class="n">salary</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&#39;(?P&lt;currency&gt;[^\d]*)(?P&lt;number_low&gt;[\d,]+) - (?P&lt;number_high&gt;[\d,]+$)&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">sal</span><span class="o">.</span><span class="n">number_low</span> <span class="o">=</span> <span class="n">sal</span><span class="o">.</span><span class="n">number_low</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="n">sal</span><span class="o">.</span><span class="n">number_high</span> <span class="o">=</span> <span class="n">sal</span><span class="o">.</span><span class="n">number_high</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="n">sal</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">sal</span><span class="o">.</span><span class="n">currency</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># mapping the new columns back to the original data frame </span>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;currency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal</span><span class="o">.</span><span class="n">currency</span>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;salary_low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal</span><span class="o">.</span><span class="n">number_low</span>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;salary_high&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal</span><span class="o">.</span><span class="n">number_high</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Fixing up Location</h2>

<p>We will also need better location information, so we can do analysis by countries and cities. For this we need to extract country, state and city out of location column.
But first let&rsquo;s remove the na values from location column. Then use a lambda to split the comma separated location value into individual fields.
Finally, rename the columns to city, location_1 and location_2. The reason for this is that the content of location can be different for different countries.</p>

<figure class='code'><figcaption><span>extracting and capturing currency and low-high figure. </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">London</span><span class="p">,</span><span class="n">UK</span>
</span><span class='line'><span class="n">New</span> <span class="n">York</span><span class="p">,</span><span class="n">NY</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>In the first expression the second member is a country and in the second expression it is a state, so we need to handle these differently.</p>

<figure class='code'><figcaption><span>split the location </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="c"># sometimes we have nothing in the location field. </span>
</span><span class='line'>
</span><span class='line'><span class="n">location_split</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)])</span>
</span><span class='line'><span class="n">locations</span> <span class="o">=</span> <span class="n">jobs</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">location_split</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">locations</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">&#39;city&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;location_1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;location_2&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>Fixing US locations</h3>

<p>So it seems that US locations are special. They are in the form of city, state, we need this to be in form of city, state, country, so let&rsquo;s fix this first.
If we have a US state in <em>location1 column then put US in </em>location2.</p>

<figure class='code'><figcaption><span>Fixing US States </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">us_states</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;AL&quot;</span><span class="p">,</span> <span class="s">&quot;AK&quot;</span><span class="p">,</span> <span class="s">&quot;AZ&quot;</span><span class="p">,</span> <span class="s">&quot;AR&quot;</span><span class="p">,</span> <span class="s">&quot;CA&quot;</span><span class="p">,</span> <span class="s">&quot;CO&quot;</span><span class="p">,</span> <span class="s">&quot;CT&quot;</span><span class="p">,</span> <span class="s">&quot;DC&quot;</span><span class="p">,</span> <span class="s">&quot;DE&quot;</span><span class="p">,</span> <span class="s">&quot;FL&quot;</span><span class="p">,</span> <span class="s">&quot;GA&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s">&quot;HI&quot;</span><span class="p">,</span> <span class="s">&quot;ID&quot;</span><span class="p">,</span> <span class="s">&quot;IL&quot;</span><span class="p">,</span> <span class="s">&quot;IN&quot;</span><span class="p">,</span> <span class="s">&quot;IA&quot;</span><span class="p">,</span> <span class="s">&quot;KS&quot;</span><span class="p">,</span> <span class="s">&quot;KY&quot;</span><span class="p">,</span> <span class="s">&quot;LA&quot;</span><span class="p">,</span> <span class="s">&quot;ME&quot;</span><span class="p">,</span> <span class="s">&quot;MD&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s">&quot;MA&quot;</span><span class="p">,</span> <span class="s">&quot;MI&quot;</span><span class="p">,</span> <span class="s">&quot;MN&quot;</span><span class="p">,</span> <span class="s">&quot;MS&quot;</span><span class="p">,</span> <span class="s">&quot;MO&quot;</span><span class="p">,</span> <span class="s">&quot;MT&quot;</span><span class="p">,</span> <span class="s">&quot;NE&quot;</span><span class="p">,</span> <span class="s">&quot;NV&quot;</span><span class="p">,</span> <span class="s">&quot;NH&quot;</span><span class="p">,</span> <span class="s">&quot;NJ&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s">&quot;NM&quot;</span><span class="p">,</span> <span class="s">&quot;NY&quot;</span><span class="p">,</span> <span class="s">&quot;NC&quot;</span><span class="p">,</span> <span class="s">&quot;ND&quot;</span><span class="p">,</span> <span class="s">&quot;OH&quot;</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;OR&quot;</span><span class="p">,</span> <span class="s">&quot;PA&quot;</span><span class="p">,</span> <span class="s">&quot;RI&quot;</span><span class="p">,</span> <span class="s">&quot;SC&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="s">&quot;TN&quot;</span><span class="p">,</span> <span class="s">&quot;TX&quot;</span><span class="p">,</span> <span class="s">&quot;UT&quot;</span><span class="p">,</span> <span class="s">&quot;VT&quot;</span><span class="p">,</span> <span class="s">&quot;VA&quot;</span><span class="p">,</span> <span class="s">&quot;WA&quot;</span><span class="p">,</span> <span class="s">&quot;WV&quot;</span><span class="p">,</span> <span class="s">&quot;WI&quot;</span><span class="p">,</span> <span class="s">&quot;WY&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span class='line'><span class="n">locations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">us_states</span><span class="p">),</span><span class="s">&#39;location_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;US&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Filling the state and country columns</h3>

<p>We are now ready to put back the city, state and country information in our original data frame.
Here is the logic, If in a row location_2 is null then location_1 contains the country of that location, if location_2 is not empty then location_2 is going to be the country and location_1 will contain the state.</p>

<figure class='code'><figcaption><span>creating city, stat and country column</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># if location_2 is null then location_1 column has the country </span>
</span><span class='line'><span class="c"># if location_2 is not null then location_2 has the country and location_1 contains the state </span>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_1&#39;</span><span class="p">],</span> <span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_2&#39;</span><span class="p">])</span>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="n">locations</span><span class="p">[</span><span class="s">&#39;location_1&#39;</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;city&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="s">&#39;city&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># filling na for country </span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># stripping spaces from new columns</span>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;city&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs</span><span class="p">[</span><span class="s">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can see what countries are posting the most jobs. It seems that the US, Deutschland, Germany and the UK are the top countries. But wait. Aren&rsquo;t Germany and Deutschland are the same country? Let&rsquo;s fix this and some other countries with native names.</p>

<figure class='code'><figcaption><span>replacing local country names with their english names</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># replacing some of the country names with their english version </span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Deutschland&#39;</span><span class="p">),</span><span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Germany&#39;</span> <span class="c"># Deutschland -&gt; Germany</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Österreich&#39;</span><span class="p">),</span><span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Austria&#39;</span> <span class="c"># Österreich -&gt; Austria</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Suisse&#39;</span><span class="p">),</span> <span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Switzerland&#39;</span> <span class="c"># Suisse -&gt; Switzerland</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Schweiz&#39;</span><span class="p">),</span> <span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Switzerland&#39;</span> <span class="c"># Schweiz -&gt; Switzerland</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Espagne&#39;</span><span class="p">),</span> <span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Spain&#39;</span> <span class="c"># Espagne -&gt; Spain</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;République tchèque&#39;</span><span class="p">),</span> <span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Czech Republic&#39;</span> <span class="c"># République tchèque -&gt; Czech Republic</span>
</span><span class='line'><span class="n">jobs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Niederlande&#39;</span><span class="p">),</span> <span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Netherlands&#39;</span> <span class="c"># Niederlande -&gt; Netherlands</span>
</span><span class='line'>
</span><span class='line'><span class="n">jobs</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we have a pretty neat table with data that we can do analytics on. In the next part, I will try to ask questions from  data and create some graphs to find out interesting stuff like:</p>

<ul>
<li>What countries has the most jobs?</li>
<li>What cities has the most jobs?</li>
<li>What technologies are the most popular?</li>
<li>What technologies are paying the most?</li>
</ul>


<p>Coming soon…</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Krisztian Gyuris</span></span>

      




<time class='entry-date' datetime='2016-09-26T11:58:11+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:58 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/jupiter-notebooks/'>jupiter notebooks</a>, <a class='category' href='/blog/categories/pandas/'>pandas</a>, <a class='category' href='/blog/categories/python/'>python</a>, <a class='category' href='/blog/categories/scrapy/'>scrapy</a>, <a class='category' href='/blog/categories/stackoverflow/'>stackoverflow</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.littlebigtomatoes.com/2016/09/playing-with-pandas/" data-via="gyurisc" data-counturl="http://www.littlebigtomatoes.com/2016/09/playing-with-pandas/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2016/08/getting-started-with-handsontable/" title="Previous Post: Getting Started with Handsontable">&laquo; Getting Started with Handsontable</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2016/09/playing-with-pandas/">Playing With Pandas</a>
      </li>
    
      <li class="post">
        <a href="/2016/08/getting-started-with-handsontable/">Getting Started With Handsontable</a>
      </li>
    
      <li class="post">
        <a href="/2016/08/scraping-stackoverflow-careers-for-fun-and-profit-part-2/">Scraping Stackoverflow Careers for Fun and Profit - Part 2</a>
      </li>
    
      <li class="post">
        <a href="/2016/07/scraping-stackoverflow-careers-for-fun-and-profit/">Scraping Stackoverflow Careers for Fun and Profit</a>
      </li>
    
      <li class="post">
        <a href="/2016/06/how-to-generate-typescript-classes-from-c-number-like-a-pro/">How to Generate Typescript Classes From C# Like a Pro</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/gyurisc">@gyurisc</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'gyurisc',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $(document).ready(function(){
      getTwitterFeed("gyurisc", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/gyurisc" class="twitter-follow-button" data-show-count="false">Follow @gyurisc</a>
  
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll&#8230;</ul>
  <p><a href="http://pinboard.in/u:gyurisc">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "gyurisc"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Krisztian Gyuris -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'littlebigtomatoes';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.littlebigtomatoes.com/2016/09/playing-with-pandas/';
        var disqus_url = 'http://www.littlebigtomatoes.com/2016/09/playing-with-pandas/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
